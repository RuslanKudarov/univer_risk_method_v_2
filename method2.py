# –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
import pandas as pd
import numpy as np
import streamlit as st
import xlrd
import io
from pandas import ExcelWriter
from io import BytesIO

# –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–∞–∫–µ—Ç
import dill

# —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
def run():
    from PIL import Image
    image = Image.open('logo.jpg')
    
    st.sidebar.image(image)
    
    question = ("–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:")
    
    add_selectbox = st.sidebar.selectbox(question, ("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö",
                                                    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",
                                                    "–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö",
                                                    "–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏",
                                                    "–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏"))
    
    sidebar_ttl = ("–ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è\n"
                  "–∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–π –Ω–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤.")

# –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    
    if add_selectbox == "–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö":
        st.sidebar.info(sidebar_ttl)
        st.title("–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel-—Ñ–∞–π–ª—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ï–ê–ò–°–£")
              
        file_abit_upload_ttl = ("–ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç—ã:")
        file_abit_upload = st.file_uploader(file_abit_upload_ttl,
                                       type = ['xls' or 'xlsx'],
                                       help = '–ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Ñ–∞–π–ª, —Å–∫–∞—á–∞–Ω–Ω—ã–π –∏–∑ –º–æ–¥—É–ª—è "–ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç—ã"')

        df_abit = pd.DataFrame()
        df_stud = pd.DataFrame()
        df_mon_all = pd.DataFrame()
        df_mon_neud = pd.DataFrame()
        df_mon_neat = pd.DataFrame()
        df_mon_usp = pd.DataFrame()
        
        if file_abit_upload is not None:
            df_abit = pd.read_excel(file_abit_upload,
                                    sheet_name = "–ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç—ã",
                                    header = 9)        
            # –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ
            check_abit = st.checkbox('–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤')
            if check_abit:
                st.write(df_abit)

        files_mon_all_upload_ttl = ("–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–≤—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã):")
        files_mon_all_upload = st.file_uploader(files_mon_all_upload_ttl,
                                                type = ['xls' or 'xlsx'],
                                                accept_multiple_files = True,
                                                help = '–ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Ñ–∞–π–ª—ã, —Å–∫–∞—á–∞–Ω–Ω—ã–µ –∏–∑ –º–æ–¥—É–ª—è "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞"')
        
        if files_mon_all_upload is not None:
            df_mon_all = pd.DataFrame()
            for file_mon_all_upload in files_mon_all_upload:
                data_mon_all = pd.read_excel(file_mon_all_upload,
                                             sheet_name = "–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤",
                                             header = 3)
                df_mon_all = pd.concat([df_mon_all, data_mon_all],
                                       ignore_index = True)
        if len(df_mon_all.index) > 0:
            # –≤—ã–≤–æ–¥ –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–≤—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã)
            check_mon_all = st.checkbox('–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–≤—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã)')
            if check_mon_all:
                st.write(df_mon_all) 
                
        files_mon_neat_upload_ttl = ("–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–Ω–µ –∞—Ç—Ç–µ—Å—Ç–æ–≤–∞–Ω—ã):")
        files_mon_neat_upload = st.file_uploader(files_mon_neat_upload_ttl,
                                                type = ['xls' or 'xlsx'],
                                                accept_multiple_files = True,
                                                help = '–ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Ñ–∞–π–ª—ã, —Å–∫–∞—á–∞–Ω–Ω—ã–µ –∏–∑ –º–æ–¥—É–ª—è "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞"')
        
        if files_mon_neat_upload is not None:
            df_mon_neat = pd.DataFrame()
            for file_mon_neat_upload in files_mon_neat_upload:
                data_mon_neat = pd.read_excel(file_mon_neat_upload,
                                             sheet_name = "–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤",
                                             header = 3)
                df_mon_neat = pd.concat([df_mon_neat, data_mon_neat],
                                       ignore_index = True)
        if len(df_mon_neat.index) > 0:
            # –≤—ã–≤–æ–¥ –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–Ω–µ –∞—Ç—Ç–µ—Å—Ç–æ–≤–∞–Ω—ã)
            check_mon_neat= st.checkbox('–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–Ω–µ –∞—Ç—Ç–µ—Å—Ç–æ–≤–∞–Ω—ã)')
            if check_mon_neat:
                st.write(df_mon_neat)
       
        files_mon_neud_upload_ttl = ('–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–∏–º–µ—é—Ç "–Ω–µ—É–¥–æ–≤–ª"):')
        files_mon_neud_upload = st.file_uploader(files_mon_neud_upload_ttl,
                                                type = ['xls' or 'xlsx'],
                                                accept_multiple_files = True,
                                                help = '–ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Ñ–∞–π–ª—ã, —Å–∫–∞—á–∞–Ω–Ω—ã–µ –∏–∑ –º–æ–¥—É–ª—è "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞"')
        
        if files_mon_neud_upload is not None:
            df_mon_neud = pd.DataFrame()
            for file_mon_neud_upload in files_mon_neud_upload:
                data_mon_neud = pd.read_excel(file_mon_neud_upload,
                                             sheet_name = "–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤",
                                             header = 3)
                df_mon_neud = pd.concat([df_mon_neud, data_mon_neud],
                                       ignore_index = True)
        if len(df_mon_neud.index) > 0:
            # –≤—ã–≤–æ–¥ –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–∏–º–µ—é—Ç "–Ω–µ—É–¥–æ–≤–ª")
            check_mon_neud = st.checkbox('–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–∏–º–µ—é—Ç "–Ω–µ—É–¥–æ–≤–ª")')
            if check_mon_neud:
                st.write(df_mon_neud)
                
        files_mon_usp_upload_ttl = ("–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—É—Å–ø–µ–≤–∞—é—Ç):")
        files_mon_usp_upload = st.file_uploader(files_mon_usp_upload_ttl,
                                                type = ['xls' or 'xlsx'],
                                                accept_multiple_files = True,
                                                help = '–ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Ñ–∞–π–ª—ã, —Å–∫–∞—á–∞–Ω–Ω—ã–µ –∏–∑ –º–æ–¥—É–ª—è "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞"')
        
        if files_mon_usp_upload is not None:
            df_mon_usp = pd.DataFrame()
            for file_mon_usp_upload in files_mon_usp_upload:
                data_mon_usp = pd.read_excel(file_mon_usp_upload,
                                             sheet_name = "–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤",
                                             header = 3)
                df_mon_usp = pd.concat([df_mon_usp, data_mon_usp],
                                       ignore_index = True)
        if len(df_mon_usp.index) > 0:
            # –≤—ã–≤–æ–¥ –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (—É—Å–ø–µ–≤–∞—é—Ç)
            check_mon_usp = st.checkbox('–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (—É—Å–ø–µ–≤–∞—é—Ç)')
            if check_mon_usp:
                st.write(df_mon_usp)

        file_stud_upload_ttl = ("–°—Ç—É–¥–µ–Ω—Ç—ã:")
        file_stud_upload = st.file_uploader(file_stud_upload_ttl,
                                            type = ['xls' or 'xlsx'],
                                            help = '–ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Ñ–∞–π–ª, —Å–∫–∞—á–∞–Ω–Ω—ã–π –∏–∑ –º–æ–¥—É–ª—è "–°—Ç—É–¥–µ–Ω—Ç—ã"')
        
        if file_stud_upload is not None:
            df_stud = pd.read_excel(file_stud_upload,
                                    sheet_name = "–û–±—É—á–∞—é—â–∏–µ—Å—è",
                                    header = 3)
            # –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ
            check_stud = st.checkbox('–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤')
            if check_stud:
                st.write(df_stud)

        if len(df_abit.index) > 0 and len(df_mon_all.index) > 0 and len(df_stud.index) > 0:
            if len(df_mon_all.index) == len(df_mon_neat.index) + len(df_mon_neud.index) + len(df_mon_usp.index):
                go_2 = st.button('–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ')
                if go_2:
        # –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        # –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç—ã
                    # —É–¥–∞–ª–∏–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤
                    # —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ –ø–æ –ø–µ—Ä–≤—ã–º 8 —Å—Ç–æ–ª–±—Ü–∞–º
                    data_ab_dd = df_abit.drop_duplicates(subset = ['–§–ò–û',
                                                                   '–ü–æ–ª',
                                                                   '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è',
                                                                   '–¢–∏–ø –£–õ',
                                                                   '–°–µ—Ä–∏—è –£–õ',
                                                                   '–ù–æ–º–µ—Ä –£–õ',
                                                                   '–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏ –£–õ',
                                                                   '–ö–µ–º –≤—ã–¥–∞–Ω–æ –£–õ'])
                    # –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
                    # –†—É—Å—Å–∫–∏–π —è–∑—ã–∫ –ï–ì–≠ –∏ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –ï–ì–≠
                    # –∑–∞–º–µ–Ω–∏–º –ø—Ä–æ–ø—É—Å–∫–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è –º–µ–Ω—å—à–µ 36 –±–∞–ª–ª–æ–≤
                    # –∑–Ω–∞—á–µ–Ω–∏–µ–º 0 –±–∞–ª–ª–æ–≤
                    ege_rus = np.where((data_ab_dd['–†—è'].isnull()) |
                                       (data_ab_dd['–†—è'] < 36),
                                       0,
                                       data_ab_dd['–†—è'])
                    ege_math = np.where((data_ab_dd['–ú'].isnull()) |
                                        (data_ab_dd['–ú'] < 36),
                                        0,
                                        data_ab_dd['–ú'])
                    # —Å–∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É–µ–º —Å—Ç–æ–ª–±–µ—Ü '–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ï–ì–≠'
                    ege = pd.DataFrame(ege_rus + ege_math,
                                       columns = ['–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ï–ì–≠'])
                    # –ø—Ä–∏—Å–≤–æ–∏–º —Å—Ç–æ–ª–±—Ü—É '–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ï–ì–≠'
                    # —Ç–∞–∫–∏–µ –∂–µ –∏–Ω–¥–µ–∫—Å—ã –∫–∞–∫ —É –º–∞—Å—Å–∏–≤–∞ data_ab_dd
                    ege_index = ege.set_index(data_ab_dd.index)
                    # –ø—Ä–∏—Å–æ–µ–¥–µ–Ω–∏–º —Å–∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü '–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ï–ì–≠'
                    # –∫ –º–∞—Å—Å–∏–≤—É data_ab_dd —Å–ø—Ä–∞–≤–∞
                    data_ab_dd_ege = pd.concat([data_ab_dd, ege_index],
                                               axis = 1)
                    # –æ—Ç–±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã –¥–ª—è —Å–ª–∏—è–Ω–∏—è —Ç–∞–±–ª–∏—Ü
                    data_ab_mer = data_ab_dd_ege[['–§–ò–û',
                                                  '–ü–æ–ª',
                                                  '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è',
                                                  '–ù—É–∂–¥–∞–µ—Ç—Å—è –≤ –æ–±—â–µ–∂–∏—Ç–∏–∏',
                                                  '–ü–æ–ª—É—á–µ–Ω–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
                                                  '–°—Ä. –±–∞–ª–ª –¥–æ–∫-—Ç–∞ –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏',
                                                  '–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ï–ì–≠']]

        # –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        # –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç—ã
                    # —Å–∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É–µ–º —Å—Ç–æ–ª–±–µ—Ü '–¢–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞'
                    data_st_eaisu = df_stud.copy()
                    data_st_eaisu['–¢–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞'] = df_stud['–í–∏–¥ –∑–∞—Ç—Ä–∞—Ç'] + ' ' + df_stud['–¶–µ–ª–µ–≤–æ–π –ø—Ä–∏–µ–º']
                    dct_tip_dog = {'–±—é–¥–∂–µ—Ç –¥–∞':'—Ü–µ–ª–µ–≤–∏–∫',
                                   '–±—é–¥–∂–µ—Ç –Ω–µ—Ç':'–±—é–¥–∂–µ—Ç–Ω–∏–∫',
                                   '–ø–æ –¥–æ–≥–æ–≤–æ—Ä—É –Ω–µ—Ç':'–ø–ª–∞—Ç–Ω–∏–∫'}
                    data_st_eaisu['–¢–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞'] = data_st_eaisu['–¢–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞'].map(dct_tip_dog)
                    # –ø–µ—Ä–µ–∏–º–µ–Ω—É–µ–º —Å—Ç–æ–ª–±—Ü—ã '–§–æ—Ä–º–∏—Ä—É—é—â–µ–µ –ø–æ–¥—Ä.', '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å)' –∏ '–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–π —Å—Ä–æ–∫'
                    data_st_rn = data_st_eaisu.rename(columns = {'–§–æ—Ä–º–∏—Ä—É—é—â–µ–µ –ø–æ–¥—Ä.':'–§–∞–∫—É–ª—å—Ç–µ—Ç',
                                                                 '–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–π —Å—Ä–æ–∫':'–°—Ä–æ–∫ –æ–±—É—á–µ–Ω–∏—è',
                                                                 '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å)':'–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏'})
                    # –æ—Ç–±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã –¥–ª—è —Å–ª–∏—è–Ω–∏—è —Ç–∞–±–ª–∏—Ü
                    data_st_mer = data_st_rn[['–§–ò–û',
                                              '–ü–æ–ª',
                                              '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è',
                                              '–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ',
                                              '–ì—Ä—É–ø–ø–∞',
                                              '–§–∞–∫—É–ª—å—Ç–µ—Ç',
                                              '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏',
                                              '–°—Ä–æ–∫ –æ–±—É—á–µ–Ω–∏—è',
                                              '–¢–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞']]

        # –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        # –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                    # –º–∞—Å—Å–∏–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–≤—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã)
                    data_m_all = df_mon_all.copy()
                    # –≤ –º–∞—Å—Å–∏–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–∏–º–µ—é—Ç –Ω–µ—É–¥–æ–≤–ª)
                    # –¥–æ–±–∞–≤–∏–º —Å–ø—Ä–∞–≤–∞ —Å—Ç–æ–ª–±–µ—Ü "–ù–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å"
                    # —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º "1" –ø–æ –≤—Å–µ–º —Å—Ç—Ä–æ–∫–∞–º
                    data_m_neud_neusp = df_mon_neud.assign(–ù–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å = 1)
                    # –≤ –º–∞—Å—Å–∏–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–Ω–µ –∞—Ç—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ)
                    # –¥–æ–±–∞–≤–∏–º —Å–ø—Ä–∞–≤–∞ —Å—Ç–æ–ª–±–µ—Ü "–ù–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å"
                    # —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º "1" –ø–æ –≤—Å–µ–º —Å—Ç—Ä–æ–∫–∞–º
                    data_m_neat_neusp = df_mon_neat.assign(–ù–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å = 1)
                    # –≤ –º–∞—Å—Å–∏–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (—É—Å–ø–µ–≤–∞—é—Ç)
                    # –¥–æ–±–∞–≤–∏–º —Å–ø—Ä–∞–≤–∞ —Å—Ç–æ–ª–±–µ—Ü "–ù–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å"
                    # —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º "0" –ø–æ –≤—Å–µ–º —Å—Ç—Ä–æ–∫–∞–º
                    data_m_usp_neusp = df_mon_usp.assign(–ù–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å = 0)
                    # –æ–±—ä–µ–¥–∏–Ω–∏–º –≤—Å–µ –º–∞—Å—Å–∏–≤—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
                    data_m = pd.concat([data_m_neud_neusp,
                                        data_m_neat_neusp,
                                        data_m_usp_neusp],
                                       ignore_index = True)
                    # –æ—Ç–±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã –¥–ª—è —Å–ª–∏—è–Ω–∏—è —Ç–∞–±–ª–∏—Ü
                    data_m_mer = data_m[['–§–ò–û',
                                         '–ü–æ–ª',
                                         '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è',
                                         '–ù–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å']]

        # –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        # —Å–ª–∏—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                    # –≤—ã–ø–æ–ª–Ω–∏–º —Å–ª–∏—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –¥–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
                    data_st_m_mer = data_st_mer.merge(data_m_mer,
                                                      how = 'inner',
                                                      on = None,
                                                      left_on = None,
                                                      right_on = None,
                                                      left_index = False,
                                                      right_index = False,
                                                      sort = False,
                                                      suffixes = ('_x', '_y'),
                                                      copy = None,
                                                      indicator = False,
                                                      validate = None)
                    # –≤—ã–ø–æ–ª–Ω–∏–º —Å–ª–∏—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –¥–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
                    # —Å –¥–∞–Ω–Ω—ã–º–∏ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤
                    data_mer = data_st_m_mer.merge(data_ab_mer,
                                                   how = 'left',
                                                   on = None,
                                                   left_on = None,
                                                   right_on = None,
                                                   left_index = False,
                                                   right_index = False,
                                                   sort = False,
                                                   suffixes = ('_x', '_y'),
                                                   copy = None,
                                                   indicator = False,
                                                   validate = None)

        # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü –¥–∞–Ω–Ω—ã—Ö
                    # —Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Ç—Ä–∏—Ü—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
                    Data_id = data_mer[['–§–ò–û',
                                        '–ì—Ä—É–ø–ø–∞']]
                    # —Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Ç—Ä–∏—Ü—É –Ω–∞–±–ª—é–¥–µ–Ω–∏–π
                    Data_X = data_mer[['–ü–æ–ª',
                                       '–ù—É–∂–¥–∞–µ—Ç—Å—è –≤ –æ–±—â–µ–∂–∏—Ç–∏–∏',
                                       '–ü–æ–ª—É—á–µ–Ω–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
                                       '–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ',
                                       '–§–∞–∫—É–ª—å—Ç–µ—Ç',
                                       '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏',
                                       '–°—Ä–æ–∫ –æ–±—É—á–µ–Ω–∏—è',
                                       '–¢–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞',
                                       '–°—Ä. –±–∞–ª–ª –¥–æ–∫-—Ç–∞ –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏',
                                       '–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ï–ì–≠']]
                    Data_Y = data_mer['–ù–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å']
                    Data_XY = pd.concat([Data_X, Data_Y],
                                        axis = 1,
                                        join = "inner")
                    # —Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Ç—Ä–∏—Ü—É –¥–∞–Ω–Ω—ã—Ö
                    Data = pd.concat([Data_id, Data_XY],
                                     axis = 1,
                                     join = "inner")

        # –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Excel
                    # –Ω–∞–ø–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –º–∞—Å—Å–∏–≤–æ–≤
                    # –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª Excel
                    def dfs_tabs(df_list, sheet_list, file_name):
                        output = BytesIO()
                        writer = pd.ExcelWriter(file_name, engine = 'xlsxwriter')   
                        for dataframe, sheet in zip(df_list, sheet_list):
                            dataframe.to_excel(writer, sheet_name = sheet, startrow = 0 , startcol = 0)   
                        writer.close()
                        processed_data = output.getvalue()
                        return processed_data
                    # —Å–æ–∑–¥–∞–¥–∏–º —Å–ø–∏—Å–æ–∫ –º–∞—Å—Å–∏–≤–æ–≤ 
                    dfs = [data_ab_dd,
                           data_ab_mer,
                           data_st_mer,
                           data_m_all,
                           data_m_neud_neusp,
                           data_m_neat_neusp,
                           data_m_usp_neusp,
                           data_m_mer,
                           data_mer,
                           Data,
                           Data_id,
                           Data_XY
                          ]
                    # —Å–æ–∑–¥–∞–¥–∏–º —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π –ª–∏—Å—Ç–æ–≤
                    sheets = ['–ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç—ã (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)',
                              '–ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç—ã (–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)',
                              '–°—Ç—É–¥–µ–Ω—Ç—ã (–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)',
                              '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–≤—Å–µ –¥–∞–Ω–Ω—ã–µ)',
                              '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–∏–º–µ—é—Ç –Ω–µ—É–¥–æ–≤–ª)',
                              '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–Ω–µ –∞—Ç—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ)',
                              '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—É—Å–ø–µ–≤–∞—é—â–∏–µ)',
                              '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)',
                              '–í—ã–±–æ—Ä–∫–∞',
                              '–ú–∞—Ç—Ä–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö',
                              '–ú–∞—Ç—Ä–∏—Ü–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤',
                              '–ú–∞—Ç—Ä–∏—Ü–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π'
                             ]
                    
                    # —Å–æ–∑–¥–∞–¥–∏–º –∫–Ω–æ–ø–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
                    df_xlsx = dfs_tabs(dfs, sheets, 'multi-test.xlsx')
                    st.download_button(label = 'üì• Download Current Result',
                                       data = df_xlsx,
                                       file_name = 'df_test.xlsx')
                    
# –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    
    if add_selectbox == "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö":
        st.sidebar.info(sidebar_ttl)
        st.title("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö")

# –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    
    if add_selectbox == "–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö":
        st.sidebar.info(sidebar_ttl)
        st.title("–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö")
    
# –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
    
    if add_selectbox == "–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏":
        st.sidebar.info(sidebar_ttl)
        st.title("–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏")

# –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
    
    if add_selectbox == "–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏":
        st.sidebar.info(sidebar_ttl)
        st.title("–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏")

if __name__ == '__main__':
    run()
